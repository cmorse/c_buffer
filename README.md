With some minor changes, copied from: http://www.codesynthesis.com/~boris/blog/2011/08/09/do-we-need-std-buffer/
